


var PaintAppToolbar=function(e){
  // jQuery('.colorPicker-picker').remove(),
  this.paintApp=e,this.inAddMode=!0,e.setDrawToolbar(this),
  //this.initControls(),
  this.listenEvents()
};
   
PaintAppToolbar.prototype.initControls=function(){
  var e=this;
 // console.log(e);
 // alert('dkm');
  jQuery("#simpleDrawToolbar").buttonset(),
  jQuery("#dropper").click(function(){
   
    
    var mode = jQuery("#pen_dropper").val(); 
    if(mode === "pen"){      
      jQuery("#pen_dropper").val('select');
      jQuery("#thicknessContainer").hide();
    }else{
      jQuery("#pen_dropper").val('pen');
      jQuery("#thicknessContainer").show();
    }
	//console.log(mode);
    paintAppGlobal.getDrawToolbar().onChangMode(jQuery("#pen_dropper").val());
    paintAppGlobal.getDrawToolbar().onActionChanged();
  }),jQuery("#btnSelect").button({
    text:!1,
    icons:{
      primary:"toolbar-icon icon-cursor"
    }
  }).click(function(){
    paintAppGlobal.getDrawToolbar().onActionChanged()
  }),jQuery("#btnDrawLine").button({
    text:!1,
    icons:{
      primary:"toolbar-icon icon-drawline"
    }
  }).click(function(){
    paintAppGlobal.getDrawToolbar().onActionChanged()
  }),jQuery("#btnDrawRectangle").button({
    text:!1,
    icons:{
      primary:"toolbar-icon icon-drawsquare"
    }
  }).click(function(){
    paintAppGlobal.getDrawToolbar().onActionChanged()
  }),jQuery("#btnDrawCircle").button({
    text:!1,
    icons:{
      primary:"toolbar-icon icon-drawcircle"
    }
  }).click(function(){
    paintAppGlobal.getDrawToolbar().onActionChanged()
  }),jQuery("#btnDrawImage").button({
    text:!1,
    icons:{
      primary:"toolbar-icon icon-drawimage"
    }
  }).click(function(){
    paintAppGlobal.getDrawToolbar().onActionChanged()
  }),jQuery("#btnDrawShape").button({
    text:!1,
    icons:{
      primary:"toolbar-icon icon-drawshape"
    }
  }).click(function(){
    paintAppGlobal.getDrawToolbar().onActionChanged()
  }),jQuery("#btnDrawText").button({
    text:!1,
    icons:{
      primary:"toolbar-icon icon-drawtext"
    }
  }).click(function(){
    paintAppGlobal.getDrawToolbar().onActionChanged()
  }),jQuery("#btnUpload").button({
    text:!1,
    icons:{
      primary:"toolbar-icon icon-upload"
    }
  }).click(function(){
    paintAppGlobal.getDrawToolbar().onActionChanged()
  }),jQuery("#complexDrawToolbar").buttonset(),jQuery("#zoomToolbar").buttonset(),
 jQuery("#zoom_in").click(function(){
   e.onZoomIn()
 }),
 jQuery("#zoom_out").click(function(){
   e.onZoomOut()
 }),
  jQuery("#rotato-right").click(function(){
  // alert('sdfsdfs');
  //console.log(e);
    e.onRotatoRight();
	
  }),jQuery("#rotato-left").click(function(){
   // alert('sdfsdfs');
  }),jQuery("#layer-down").click(function(){
    paintAppGlobal.layerDown();
  }),jQuery("#layer-up").click(function(){
    paintAppGlobal.layerUp();
  }),
  //alert('cc'),
  jQuery("#xcopy").click(function(){
	 // alert('deo');
    e.onDelete();
    //setDone();
	 
    //console.log(JSON.stringify(paintAppGlobal.canvas));
  }),
  
  //// key events
  
  jQuery(document).bind('keyup', 'del', function(){
    e.onDelete();
  //  setDone();
  }),
  jQuery(document).bind('keypress', 'left', function(){
    e.onMovingLeft();
    //setDone();
  }),
  jQuery(document).bind('keyup', 'left', function(){
   // setDone();
  }),
  jQuery(document).bind('keypress', 'up', function(){
    e.onMovingUp();
    //setDone();
  }),
  jQuery(document).bind('keyup', 'up', function(){
  //  setDone();
  }),
  jQuery(document).bind('keypress', 'right', function(){
    e.onMovingRight();
    //setDone();
  }),
  jQuery(document).bind('keyup', 'right', function(){
   // setDone();
  }),
  jQuery(document).bind('keypress', 'down', function(){
    e.onMovingDown();
    //setDone();
  }),
  jQuery(document).bind('keyup', 'down', function(){
    //setDone();
  }),
//  jQuery(document).bind('keydown', 'ctrl+z', function(){
//    console.log('sdasd');
//    jQuery('#undo').trigger('click');
//  }),
//  jQuery(document).bind('keydown', 'ctrl+y', function(){
//    console.log('sdasd');
//    jQuery('#redo').trigger('click');
//  }),
  
  ////
  
  
  jQuery("#bucket").click(function(){
    //getResultCanvasLayer();
    if(paintAppGlobal.currentMode === 'bucket'){
		//alert('sada');
      paintAppGlobal.processMode('select');
      paintAppGlobal.getDrawToolbar().onChangMode('select');
      selectLayer(current_group_layer);
    }else{
		//alert('sada1');
      paintAppGlobal.processMode('bucket');
      paintAppGlobal.getDrawToolbar().onChangMode('bucket');
      var objects = paintAppGlobal.canvas.getObjects();
      for(var x in objects){
        objects[x].selectable = false;
      }  
    }
  }),jQuery("#layer-clock").click(function(){
    lockGroupLayer();
  }),jQuery("#lockOption").buttonset(),jQuery("#btnLock").button({
    text:!1,
    icons:{
      primary:"toolbar-icon-small icon-unlock"
    }
  }).click(function(){
    e.onLock()
  }),jQuery("#btnLock").change(function(){
    jQuery("#btnLock").attr("checked")?jQuery("#btnLock").button({
      icons:{
        primary:"toolbar-icon-small icon-lock"
      }
    }):jQuery("#btnLock").button({
      icons:{
        primary:"toolbar-icon-small icon-unlock"
      }
    })
  }),jQuery("#positionOptions").buttonset(),jQuery("#elementPositioDescription").button({
    disabled:!0,
    text:!0,
    icons:{
      primary:"toolbar-icon-small icon-empty"
    }
  }),jQuery("#btnBringToFront").button({
    text:!1,
    icons:{
      primary:"toolbar-icon-small icon-bringtofront"
    }
  }).click(function(){
    e.onBringToFront()
  }),jQuery("#btnSendToBack").button({
    text:!1,
    icons:{
      primary:"toolbar-icon-small icon-sendtoback"
    }
  }).click(function(){
    e.onSendToBack()
  }),jQuery("#opacitySlider").slider({
    value:100,
    slide:function(){
      e.onOpacityChanged()
    },
    stop: function( event, ui ) {
      setDone();
    }
  }),jQuery("#thicknessSlider").slider({
    min:1,
    max:50,
    value:5,
    slide:function(){
      jQuery("#thicknessValueDisplay").html(jQuery("#thicknessSlider").slider("value")),e.onThicknessChanged()
    }
  }),jQuery("#thicknessValueDisplay").html(jQuery("#thicknessSlider").slider("value")),
  
  jQuery("#primaryColorSelector").spectrum({
    color: "#ff0000",
    showButtons: false,
    showInput: false,
    showInitial: true,
    showPalette: true,
    showSelectionPalette: true,
    maxPaletteSize: 10,
    show: function () {
      
    },
    beforeShow: function () {
    },
    move: function (color) {
      e.onFillChanged(color.toHexString()); // #ff0000
    },
    palette: [
    ["rgb(0, 0, 0)", "rgb(67, 67, 67)", "rgb(102, 102, 102)", /*"rgb(153, 153, 153)","rgb(183, 183, 183)",*/
    "rgb(204, 204, 204)", "rgb(217, 217, 217)", /*"rgb(239, 239, 239)", "rgb(243, 243, 243)",*/ "rgb(255, 255, 255)"],
    ["rgb(152, 0, 0)", "rgb(255, 0, 0)", "rgb(255, 153, 0)", "rgb(255, 255, 0)", "rgb(0, 255, 0)",
    "rgb(0, 255, 255)", "rgb(74, 134, 232)", "rgb(0, 0, 255)", "rgb(153, 0, 255)", "rgb(255, 0, 255)"],
    ["rgb(230, 184, 175)", "rgb(244, 204, 204)", "rgb(252, 229, 205)", "rgb(255, 242, 204)", "rgb(217, 234, 211)",
    "rgb(208, 224, 227)", "rgb(201, 218, 248)", "rgb(207, 226, 243)", "rgb(217, 210, 233)", "rgb(234, 209, 220)",
    "rgb(221, 126, 107)", "rgb(234, 153, 153)", "rgb(249, 203, 156)", "rgb(255, 229, 153)", "rgb(182, 215, 168)",
    "rgb(162, 196, 201)", "rgb(164, 194, 244)", "rgb(159, 197, 232)", "rgb(180, 167, 214)", "rgb(213, 166, 189)",
    "rgb(204, 65, 37)", "rgb(224, 102, 102)", "rgb(246, 178, 107)", "rgb(255, 217, 102)", "rgb(147, 196, 125)",
    "rgb(118, 165, 175)", "rgb(109, 158, 235)", "rgb(111, 168, 220)", "rgb(142, 124, 195)", "rgb(194, 123, 160)",
    "rgb(166, 28, 0)", "rgb(204, 0, 0)", "rgb(230, 145, 56)", "rgb(241, 194, 50)", "rgb(106, 168, 79)",
    "rgb(69, 129, 142)", "rgb(60, 120, 216)", "rgb(61, 133, 198)", "rgb(103, 78, 167)", "rgb(166, 77, 121)",
    /*"rgb(133, 32, 12)", "rgb(153, 0, 0)", "rgb(180, 95, 6)", "rgb(191, 144, 0)", "rgb(56, 118, 29)",
            "rgb(19, 79, 92)", "rgb(17, 85, 204)", "rgb(11, 83, 148)", "rgb(53, 28, 117)", "rgb(116, 27, 71)",*/
    "rgb(91, 15, 0)", "rgb(102, 0, 0)", "rgb(120, 63, 4)", "rgb(127, 96, 0)", "rgb(39, 78, 19)",
    "rgb(12, 52, 61)", "rgb(28, 69, 135)", "rgb(7, 55, 99)", "rgb(32, 18, 77)", "rgb(76, 17, 48)"]
    ]      
    
  }),
  jQuery("#fontSize").change(function(){
    e.onFontSizeChanged()
  }),jQuery("#fontStyles").buttonset(),jQuery("#fontStyleBold").button({
    text:!1,
    icons:{
      primary:"toolbar-icon-small icon-bold"
    }
  }).click(function(){
    e.onBoldCheckChanged()
  }),jQuery("#fontStyleItalic").button({
    text:!1,
    icons:{
      primary:"toolbar-icon-small icon-italic"
    }
  }).click(function(){
    e.onItalicCheckChanged()
  }),jQuery("#fontStyleUnderline").button({
    text:!1,
    icons:{
      primary:"toolbar-icon-small icon-underline"
    }
  }).click(function(){
    e.onUnderlineCheckChanged()
  })
 // ,jQuery("#imageSelector").jcarousel({
  //  visible:4
 // }),jQuery("#shapeSelector").jcarousel({
  //  visible:4
 // })
  ,this.onActionChanged()
},PaintAppToolbar.prototype.listenEvents=function(){
  jQuery("#btnZoomIn").click(function(){}),
  jQuery("#btnZoomOut").click(function(){})
},PaintAppToolbar.prototype.getFill=function(){
  return rgb2hex(jQuery(".sp-preview-inner").css("backgroundColor"))
},PaintAppToolbar.prototype.getStroke=function(){
  return rgb2hex(jQuery(".sp-preview-inner").css("backgroundColor"))
},PaintAppToolbar.prototype.getStrokeWidth=function(){
  return jQuery("#thicknessSlider").slider("value")
},PaintAppToolbar.prototype.getOpacity=function(){
  return jQuery("#opacitySlider").slider("value")
},PaintAppToolbar.prototype.getFont=function(){
  return jQuery("#fontSelector").val()
},PaintAppToolbar.prototype.getFontSize=function(){
	console.log(jQuery("#fontSize").val());
  return jQuery("#fontSize").val()
},PaintAppToolbar.prototype.getFontBold=function(){
  return jQuery("#fontStyleBold").prop("checked")
},PaintAppToolbar.prototype.getFontItalic=function(){
  return jQuery("#fontStyleItalic").prop("checked")
},PaintAppToolbar.prototype.getFontUnderline=function(){
  return jQuery("#fontStyleUnderline").prop("checked")
},PaintAppToolbar.prototype.onZoomIn=function(){

  //console.log("Zoom in");
  var e=paintAppGlobal.getCanvas();
  if(!e.getActiveObject())
    return;
	if(e.getActiveObject().type == "image" && e.getActiveObject().scaleX >= 1)
		return;
  e.getActiveObject().scaleToHeight(e.getActiveObject().getHeight()*1.2);
  e.renderAll();
},PaintAppToolbar.prototype.onZoomOut=function(){
  var e=paintAppGlobal.getCanvas();
  if(!e.getActiveObject())
    return;
  e.getActiveObject().scaleToHeight(e.getActiveObject().getHeight()/1.2);
  e.renderAll();
},PaintAppToolbar.prototype.onRotatoRight=function(){
	//alert('sdfsdfs');
  var e=paintAppGlobal.getCanvas();
  //console.log(e);
  if(!e.getActiveObject())
    return;
  e.getActiveObject().rotate(e.getActiveObject().get('angle') + 5) ;
  e.renderAll();
},PaintAppToolbar.prototype.onRotatoLeft=function(){
  var e=paintAppGlobal.getCanvas();
  if(!e.getActiveObject())
    return;
  e.getActiveObject().rotate(e.getActiveObject().get('angle') - 5) ;
  e.renderAll();
},PaintAppToolbar.prototype.onMovingLeft=function(){
  var e=paintAppGlobal.getCanvas();
  if(!e.getActiveObject() || e.getActiveObject().left < 0)
    return;
  e.getActiveObject().set({'left': e.getActiveObject().get('left') - 5}) ;
  e.renderAll();
},PaintAppToolbar.prototype.onMovingRight=function(){
  var e=paintAppGlobal.getCanvas();
  if(!e.getActiveObject() || e.getActiveObject().left > e.getWidth())
    return;
 e.getActiveObject().set({'left': e.getActiveObject().get('left') + 5}) ;
  e.renderAll();
},PaintAppToolbar.prototype.onMovingUp=function(){
  var e=paintAppGlobal.getCanvas();
  if(!e.getActiveObject() || e.getActiveObject().top < 0)
    return;
  e.getActiveObject().set({'top': e.getActiveObject().get('top') - 5}) ;
  e.renderAll();
},PaintAppToolbar.prototype.onMovingDown=function(){
  var e=paintAppGlobal.getCanvas();
  if(!e.getActiveObject() || e.getActiveObject().top  > e.getHeight())
    return;
  e.getActiveObject().set({'top': e.getActiveObject().get('top') + 5}) ;
  e.renderAll();
},PaintAppToolbar.prototype.onDelete=function(){
//console.log(JSON.stringify(paintAppGlobal.canvas));
  var e=paintAppGlobal.canvas;
  if(e.getActiveGroup()){
  /*var t=e.getActiveGroup().getObjects();
    e.discardActiveGroup(),t.forEach(function(t){
      t.lockRotation!=1&&e.removeQuickly(t)
    },this),e.renderAll()*/
  }else if(e.getActiveObject()){
    var n=e.getActiveObject();
    removePriceObject(n.price);
    n.lockRotation!=1&&e.remove(n)
  }
},PaintAppToolbar.prototype.onLock=function(){
  var e=paintAppGlobal.getCanvas(),t=e.getActiveObject();
  t.lockRotation==1?t.lockRotation=t.lockUniScaling=t.lockMovementX=t.lockMovementY=t.lockScalingX=t.lockScalingY=!1:t.lockRotation=t.lockUniScaling=t.lockMovementX=t.lockMovementY=t.lockScalingX=t.lockScalingY=!0
},PaintAppToolbar.prototype.onBringToFront=function(){
  var e=paintAppGlobal.getCanvas();
  e.getActiveObject()&&e.bringToFront(e.getActiveObject())
},PaintAppToolbar.prototype.onSendToBack=function(){
  var e=paintAppGlobal.getCanvas();
  //e.getActiveObject()&&e.sendToBack(e.getActiveObject());e.renderAll();
  e.sendToBack(e.getActiveObject());
  e.renderAll();
},PaintAppToolbar.prototype.onOpacityChanged=function(){
var listGroup = getCurrentList();
  listGroup[current_group_layer].changeOpacity(this.getOpacity()/100)
//this.changeProperty("opacity",this.getOpacity()/100)
},PaintAppToolbar.prototype.onThicknessChanged=function(){
  this.changeProperty("strokeWidth",this.getStrokeWidth())
},PaintAppToolbar.prototype.onFillChanged=function(e){
  this.changeProperty("fill",e)
},PaintAppToolbar.prototype.onStrokeChanged=function(e){
  this.changeProperty("stroke","#"+e)
},PaintAppToolbar.prototype.onBoldCheckChanged=function(){
  this.changeProperty("fontWeight",this.getFontBold()?"bold":"100"); 
},PaintAppToolbar.prototype.onItalicCheckChanged=function(){
  this.changeProperty("fontStyle",this.getFontItalic()?"italic":"normal")
},PaintAppToolbar.prototype.onUnderlineCheckChanged=function(){
  this.changeProperty("textDecoration",this.getFontUnderline()?"underline":"")
},PaintAppToolbar.prototype.onFontChanged=function(){
  var n=paintAppGlobal.canvas.getActiveObject();
  if(n) n.set("fontFamily",this.getFont());
  paintAppGlobal.canvas.renderAll();
//this.changeProperty("fontFamily",this.getFont())
},PaintAppToolbar.prototype.onFontSizeChanged=function(){
  var e=paintAppGlobal.getCanvas().getActiveObject();
  e&&(e.setFontsize(this.getFontSize()),paintAppGlobal.canvas.renderAll())
},PaintAppToolbar.prototype.changeProperty=function(e,t){
  var n=paintAppGlobal.canvas.getActiveObject(),r=this.getMode();
  if(r==="pen")paintAppGlobal.canvas.freeDrawingColor=this.getFill(),paintAppGlobal.canvas.freeDrawingLineWidth=this.getStrokeWidth();
  else if(n)return n.set(e,t),paintAppGlobal.canvas.renderAll(),!0;
  return!1
},PaintAppToolbar.prototype.getMode=function(){
  return jQuery("#pen_dropper").val()
},PaintAppToolbar.prototype.hideAllSecondaryToolbars=function(){

  },PaintAppToolbar.prototype.setSelectedObject=function(e){
    if(!e)return;
    var t=jQuery("input[name='drawAction']:checked").val();
    this.hideAllSecondaryToolbars(),jQuery("#commonToolbars").show(),this.inAddMode=!0,jQuery("#opacitySlider").slider({
      value:e.get("opacity")*100
    });
    var n=e.get("strokeWidth");
    n&&(jQuery("#thicknessSlider").slider({
      value:n
    }),jQuery("#thicknessValueDisplay").html(jQuery("#thicknessSlider").slider("value")));
    var n=e.get("stroke");
    n&&(jQuery(".sp-preview-inner").css("backgroundColor",n));
    var n=e.get("fill");
    n&&(jQuery(".sp-preview-inner").css("backgroundColor",n)),e.lockRotation==1?jQuery("#btnLock").prop("checked",!0).change():jQuery("#btnLock").prop("checked",!1).change();
    var r=e.type;
 
  },PaintAppToolbar.prototype.onActionChanged=function(){    
    var e=jQuery("#pen_dropper").val(); 
    if(e==="pen"){
      //      if(this.paintApp.checkLockLayerCurrent()){
      //        e = "select";
      //      }
      paintAppGlobal.canvas.freeDrawingColor=this.getFill();
      //paintAppGlobal.canvas.freeDrawingLineWidth=this.getStrokeWidth();
      paintAppGlobal.canvas.freeDrawingLineWidth = this.getStrokeWidth();
    }
    paintAppGlobal.processMode(e);
    
  },PaintAppToolbar.prototype.onChangMode=function(mode){    
    jQuery("#dropper").removeClass('select-non-pen');
    jQuery("#bucket").removeClass('select-bucket');
    
    if(mode === 'pen'){
      jQuery("#dropper").addClass('select-non-pen');
      paintAppGlobal.canvas.freeDrawingCursor = 'url(resources/images/dropper.cur) 10 20,auto';
//      paintAppGlobal.canvas.hoverCursor = 'url(http://www.peopleschoiceapparel.com/media/bss_design/dropper.cur) 10 20,auto';
//      paintAppGlobal.canvas.defaultCursor = 'url(http://www.peopleschoiceapparel.com/media/bss_design/dropper.cur) 10 20,auto';
    }else if(mode === 'bucket'){
      jQuery("#bucket").addClass('select-bucket');
      paintAppGlobal.canvas.hoverCursor = 'url(resources/images/bucket.cur) 20 20,auto';
      paintAppGlobal.canvas.defaultCursor = 'url(resources/images/bucket.cur) 20 20,auto';
    }else{
      paintAppGlobal.canvas.hoverCursor = 'move';
      paintAppGlobal.canvas.defaultCursor = 'default';
    }
  }
 